<!DOCTYPE html>
<html>
  <head>
    <title>ES6 Test</title>
    <style>
      canvas {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <h1 id="message"></h1>
    <canvas id="canvas" width="500" height="500"></canvas>
    <script src="../bower_components/traceur/traceur.js"></script>
    <script src="../bower_components/es6-module-loader/dist/es6-module-loader.js"></script>
    <script>
      traceur.options.experimental = true;
      traceur.options.blockBinding = true;
    </script>
    <script type="module">

      Promise.all([
        System.import('Ball'),
        System.import('Mouse')
      ]).then(function(modules) {
        let Ball = modules[0].Ball;
        let Mouse = modules[1].Mouse;

        var mouse = new Mouse(document.getElementsByTagName('canvas')[0]);

        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');

        let balls = [];
        for(let i = 0; i < 5; ++i) {
          var ball = new Ball({
            context,
            bounce: (Math.random() * 0.7) + 0.2,
            weight: (Math.random() * 0.4) + 0.6,
            x: 50 + (i * 100),
            radius: (Math.random() * 40) + 10,
            color: 'rgb('+Math.round(Math.random() * 255)+','+Math.round(Math.random() * 255)+','+Math.round(Math.random() * 255)+')'
          });
          balls.push(ball);
        }

        (function render() {
          context.clearRect(0, 0, canvas.width, canvas.height);
          balls.forEach(ball => ball.setGravityPoint(mouse.position));
          balls.forEach(ball => ball.tick());
          balls.forEach(ball => ball.draw());
          window.requestAnimationFrame(render);
        })();

      }, function(err) {
        alert('Error loading module', err)
      });

    </script>
  </body>
</html>